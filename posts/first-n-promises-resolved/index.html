<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <title>First N Promises Resolved</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="Examples for how to get the first n promises resolved from an array"
  />
  
    <meta name="author" content="Tyler Lawson" />
  

  <!-- plugins -->
  
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hover.css/2.1.0/css/hover-min.css" />
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,700,900&amp;display=swap" />
  
    <link rel="stylesheet" href="https://tyler-lawson.com/plugins/text-animation/text-animation.css" />
  
    <link rel="stylesheet" href="https://tyler-lawson.com/plugins/hugrid/hugrid.css" />
  

  <!-- Main Stylesheet -->

  
  <link rel="stylesheet" href="https://tyler-lawson.com/css/style.min.css" media="screen" />

  <!--Favicon-->

  
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicon/favicon-16x16.png"
    />
    <link rel="manifest" href="/favicon/manifest.json" />
    <link
      rel="mask-icon"
      href="/favicon/safari-pinned-tab.svg"
      color="#374a67"
    />
    <meta
      name="theme-color"
      content="#fff"
    />
    
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZMLVM62DMD"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-ZMLVM62DMD');
    </script>
  
</head>
<body>
  <!-- preloader start -->
  <div class="preloader">
    
      <img src="https://tyler-lawson.com/images/preloader.gif" alt="preloader" />
    
  </div>
  <!-- preloader end -->


  <section class="menu menu-fix" id="menu">
  <nav>
    
    <div class="menu-container">
      <div class="desktop-menu-logo">
        <a href="/"
          ><img
            class="img-fluid"
            src="https://tyler-lawson.com/images/logo.svg"
            alt="Tyler Lawson"
            id="desktop-logo"
        /></a>
      </div>
      <ul class="desktop-menu list-inline mb-0" id="desktop-menu">
        
          <li class="menu-item hvr-underline-from-left 1">
            <a href="/">Home</a>
          </li>
        
          <li class="menu-item hvr-underline-from-left 2">
            <a href="/posts">Posts</a>
          </li>
        
      </ul>
      
      <div class="mobile-menu">
        <div class="mobile-menu-nav">
          <a class="menu-link">
            <span></span>
            <span></span>
            <span></span>
          </a>
        </div>
        <div class="mobile-menu-logo">
          <a href="/"
            ><img
              class="img-fluid"
              src="https://tyler-lawson.com/images/logo-dark.svg"
              alt="Tyler Lawson"
          /></a>
        </div>
        <div class="menu-slider">
          <nav>
            <ul class="mobile-menu-list">
              
                <li class="mobile-menu-item 1 mx-auto">
                  <a href="/">Home</a>
                </li>
              
                <li class="mobile-menu-item 1 mx-auto">
                  <a href="/posts">Posts</a>
                </li>
              
            </ul>
            <ul class="mobile-menu-icons list-inline mx-auto">
              
                <li>
                  <a href="https://github.com/tylerjlawson"
                    ><i class="fab fab fa-github fa-2x"></i
                  ></a>
                </li>
              
                <li>
                  <a href="https://www.linkedin.com/in/tyler-lawson-3a370b137/"
                    ><i class="fab fab fa-linkedin fa-2x"></i
                  ></a>
                </li>
              
                <li>
                  <a href="mailto:tylerjlawson2@gmail.com"
                    ><i class="fab fas fa-envelope fa-2x"></i
                  ></a>
                </li>
              
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </nav>
</section>


  <div class="under-menu col-lg-8 col-md-10 col-12 mx-auto post-container">
    <h1>First N Promises Resolved</h1>
    <span class="date">Posted on: 5/13/2021</span>
    <img src="/images/posts/js-promise.jpg" alt="First N Promises Resolved" />
    <div class="body">
      <p>With Javascript at the moment, it is really easy to get the first 1 or <em>l</em> promises resolved in a list, where <em>l</em> is the length of the list. This is achieved with <code>Promise.race</code> and <code>Promise.all</code> respectively. When creating production applications <code>Promise.allResolved</code> is normally preferred since it will resolve even if one of the promises errors, but for the purposes of this post I will assume that all promises resolve successfully.</p>
<p>Let&rsquo;s say you have a list of 3 promises and you want to obtain the first two that resolve. To do this, we can group all possible pairs of two promises, use <code>Promise.all</code> on the two, then combine them into a larger array, where we <code>race</code> for the first two to be resolved.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">promises</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">p1</span>, <span style="color:#a6e22e">p2</span>, <span style="color:#a6e22e">p3</span>];
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">combinedPromises</span> <span style="color:#f92672">=</span> [
  Promise.<span style="color:#a6e22e">all</span>([<span style="color:#a6e22e">promises</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">promises</span>[<span style="color:#ae81ff">1</span>]]),
  Promise.<span style="color:#a6e22e">all</span>([<span style="color:#a6e22e">promises</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">promises</span>[<span style="color:#ae81ff">2</span>]]),
  Promise.<span style="color:#a6e22e">all</span>([<span style="color:#a6e22e">promises</span>[<span style="color:#ae81ff">1</span>], <span style="color:#a6e22e">promises</span>[<span style="color:#ae81ff">2</span>]])
];
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">firstTwo</span> <span style="color:#f92672">=</span> Promise.<span style="color:#a6e22e">race</span>(<span style="color:#a6e22e">combinedPromises</span>);
</code></pre></div><p>This is nice when we just want to get the first two from a list of three, but I would like to extend this to get the first <em>n</em> from an array of length <em>l</em>.</p>
<p>The first thing I will need is a way to generate all possible index pairs of length <em>n</em> from the array. For the previous example this was <code>[[0, 1], [0, 2], [1, 2]]</code> and was used in <code>combinedPromises</code>. Thankfully there is a <a href="https://www.geeksforgeeks.org/print-all-possible-combinations-of-r-elements-in-a-given-array-of-size-n/">geeks for geeks post on this topic</a>, where they are printing all possible combinations. I will slightly modify this to collect the list of lists I am looking for.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">combinationsUtil</span>(<span style="color:#a6e22e">arr</span>, <span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">result</span>) {
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">index</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">r</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">resultString</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">result</span>);
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newResult</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">r</span>);
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">resultString</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">newResult</span>))) {
      <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">newResult</span>);
    }
  }
  <span style="color:#75715e">// When no more elements are there
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// to put in data[]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">i</span> <span style="color:#f92672">&gt;=</span> <span style="color:#a6e22e">arr</span>.<span style="color:#a6e22e">length</span>) <span style="color:#66d9ef">return</span>;

  <span style="color:#75715e">// current is included, put
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// next at next location
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">index</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">arr</span>[<span style="color:#a6e22e">i</span>];
  <span style="color:#a6e22e">combinationsUtil</span>(<span style="color:#a6e22e">arr</span>, <span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">result</span>);

  <span style="color:#75715e">// current is excluded, replace
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// it with next (Note that
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// i+1 is passed, but index is not changed)
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">combinationsUtil</span>(<span style="color:#a6e22e">arr</span>, <span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">result</span>);
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">combinationsFromLength</span>(<span style="color:#a6e22e">l</span>, <span style="color:#a6e22e">n</span>) {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">arr</span> <span style="color:#f92672">=</span> [...Array(<span style="color:#a6e22e">l</span>).<span style="color:#a6e22e">keys</span>()];
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> [];
  <span style="color:#a6e22e">combinationsUtil</span>(<span style="color:#a6e22e">arr</span>, <span style="color:#a6e22e">n</span>, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">new</span> Array(<span style="color:#a6e22e">n</span>), <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">result</span>);
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>;
}

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">combinationsFromLength</span>(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">2</span>);
<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">result</span>);
<span style="color:#75715e">// OUTPUT: [[0, 1], [0, 2], [1, 2]]
</span></code></pre></div><p>Now that we have our list of possible pairings we can write a function that returns the first <em>n</em> promises to resolve.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">promiseSome</span>(<span style="color:#a6e22e">promises</span>, <span style="color:#a6e22e">n</span>) {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">combinations</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">combinationsFromLength</span>(<span style="color:#a6e22e">promises</span>.<span style="color:#a6e22e">length</span>, <span style="color:#a6e22e">n</span>);
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">allGroups</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">combinations</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">group</span>) =&gt;
    Promise.<span style="color:#a6e22e">all</span>(<span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">ind</span>) =&gt; <span style="color:#a6e22e">promises</span>[<span style="color:#a6e22e">ind</span>]))
  );
  <span style="color:#66d9ef">return</span> Promise.<span style="color:#a6e22e">race</span>(<span style="color:#a6e22e">allGroups</span>);
}
</code></pre></div><p>Now we can test this out we can make some promises using <code>setTimeout</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">testPromise</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">ms</span>, <span style="color:#a6e22e">message</span>) =&gt;
  <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>) =&gt;
    <span style="color:#a6e22e">setTimeout</span>(() =&gt; {
      <span style="color:#a6e22e">resolve</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">message</span><span style="color:#e6db74">}</span><span style="color:#e6db74">: took </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">ms</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> ms`</span>);
    }, <span style="color:#a6e22e">ms</span>)
  );

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">p1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">testPromise</span>(<span style="color:#ae81ff">3000</span>, <span style="color:#e6db74">&#39;Promise One&#39;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">p2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">testPromise</span>(<span style="color:#ae81ff">1000</span>, <span style="color:#e6db74">&#39;Promise Two&#39;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">p3</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">testPromise</span>(<span style="color:#ae81ff">500</span>, <span style="color:#e6db74">&#39;Promise Three&#39;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">p4</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">testPromise</span>(<span style="color:#ae81ff">1100</span>, <span style="color:#e6db74">&#39;Promise Four&#39;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">promises</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">p1</span>, <span style="color:#a6e22e">p2</span>, <span style="color:#a6e22e">p3</span>, <span style="color:#a6e22e">p4</span>];

(<span style="color:#66d9ef">async</span> () =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">firstThree</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">promiseSome</span>(<span style="color:#a6e22e">promises</span>, <span style="color:#ae81ff">3</span>);
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">firstThree</span>);
  <span style="color:#75715e">// OUTPUT: [&#34;Promise Two: took 1000 ms&#34;, &#34;Promise Three: took 500 ms&#34;, &#34;Promise Four: took 1100 ms&#34;]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">firstTwo</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">promiseSome</span>(<span style="color:#a6e22e">promises</span>, <span style="color:#ae81ff">2</span>);
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">firstTwo</span>);
  <span style="color:#75715e">// OUTPUT: [&#34;Promise Two: took 1000 ms&#34;, &#34;Promise Three: took 500 ms&#34;]
</span><span style="color:#75715e"></span>})();
</code></pre></div><p>Now we can effectively get the first <em>n</em> promises resolved from a list of promises whenever we want!</p>

    </div>
  </div>

  <div class="footer container text-center" id="contact">
  <ul class="footer-icons list-inline">
    
      <li>
        <a href="https://github.com/tylerjlawson" target="_blank" rel="noreferrer"
          ><i class="fab fa-github footer-icon fa-3x" aria-label="Github"></i
        ></a>
      </li>
    
      <li>
        <a href="https://www.linkedin.com/in/tyler-lawson-3a370b137/" target="_blank" rel="noreferrer"
          ><i class="fab fa-linkedin footer-icon fa-3x" aria-label="LinkedIn"></i
        ></a>
      </li>
    
      <li>
        <a href="mailto:tylerjlawson2@gmail.com" target="_blank" rel="noreferrer"
          ><i class="fas fa-envelope footer-icon fa-3x" aria-label="Email"></i
        ></a>
      </li>
    
  </ul>
  <div class="credit">
    Copyright Tyler Lawson ©
    <span id="current-year"></span>
  </div>
</div>

<!-- JS Plugins -->

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.js"></script>

  <script src="https://tyler-lawson.com/plugins/text-animation/text-animation.js"></script>

  <script src="https://tyler-lawson.com/plugins/hugrid/hugrid.min.js"></script>


<!-- Main Scripts -->

<script src="https://tyler-lawson.com/js/script.min.js"></script>

<script src="https://tyler-lawson.com/js/hugrid.custom.min.js"></script>
</body>
</html>
